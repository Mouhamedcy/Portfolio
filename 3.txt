-- 1. Employés masculins par ancienneté
SELECT 
    EMPLOYEE_NUMBER, 
    RPAD(FIRST_NAME, 20) AS FIRST_NAME, 
    RPAD(LAST_NAME, 20) AS LAST_NAME, 
    YEAR(CURDATE()) - YEAR(BIRTH_DATE) AS Age, 
    YEAR(CURDATE()) - YEAR(HIRE_DATE) AS Seniority
FROM 
    EMPLOYEES
WHERE 
    SALARY + COALESCE(COMMISSION, 0) >= 8000 
    AND POSITION = 'Male'
ORDER BY 
    Seniority DESC;

-- 2. Produits spécifiques
SELECT 
    PRODUCT_REF, 
    PRODUCT_NAME, 
    SUPPLIER_NUMBER, 
    UNITS_ON_ORDER, 
    UNIT_PRICE
FROM 
    PRODUCTS
WHERE 
    QUANTITY = 'bottle(s)' 
    AND (SUBSTRING(PRODUCT_NAME, 3, 1) = 't' OR SUBSTRING(PRODUCT_NAME, 3, 1) = 'T')
    AND SUPPLIER_NUMBER IN (1, 2, 3) 
    AND UNIT_PRICE BETWEEN 70 AND 200 
    AND UNITS_ON_ORDER IS NOT NULL;

-- 3. Clients dans la même région que le fournisseur 1
SELECT 
    *
FROM 
    CUSTOMERS
WHERE 
    (CITY, COUNTRY, RIGHT(POSTAL_CODE, 3)) IN (
        SELECT 
            CITY, COUNTRY, RIGHT(POSTAL_CODE, 3)
        FROM 
            SUPPLIERS
        WHERE 
            SUPPLIER_NUMBER = 1
    );

-- 4. Nouveaux taux de réduction pour les commandes
SELECT 
    ORDER_NUMBER,
    CASE 
        WHEN (UNIT_PRICE * QUANTITY) BETWEEN 0 AND 2000 THEN 0
        WHEN (UNIT_PRICE * QUANTITY) BETWEEN 2001 AND 10000 THEN 5
        WHEN (UNIT_PRICE * QUANTITY) BETWEEN 10001 AND 40000 THEN 10
        WHEN (UNIT_PRICE * QUANTITY) BETWEEN 40001 AND 80000 THEN 15
        ELSE 20
    END AS New_Discount_Rate,
    CASE 
        WHEN ORDER_NUMBER BETWEEN 10000 AND 10999 THEN 'apply old discount rate'
        ELSE 'apply new discount rate'
    END AS Discount_Application_Note
FROM 
    ORDERS
WHERE 
    ORDER_NUMBER BETWEEN 10998 AND 11003;

-- 5. Fournisseurs de produits de boisson
SELECT 
    SUPPLIER_NUMBER, 
    COMPANY, 
    ADDRESS, 
    PHONE
FROM 
    SUPPLIERS
WHERE 
    SUPPLIER_NUMBER IN (
        SELECT DISTINCT SUPPLIER_NUMBER 
        FROM PRODUCTS 
        WHERE CATEGORY_CODE IN (SELECT CATEGORY_CODE FROM CATEGORIES WHERE CATEGORY_NAME LIKE '%Beverage%')
    );

-- 6. Clients de Berlin avec un maximum de 1 produit dessert commandé
SELECT 
    CUSTOMER_CODE
FROM 
    CUSTOMERS
WHERE 
    CITY = 'Berlin' 
    AND CUSTOMER_CODE NOT IN (
        SELECT CUSTOMER_CODE 
        FROM ORDERS O
        JOIN ORDER_DETAILS OD ON O.ORDER_NUMBER = OD.ORDER_NUMBER
        JOIN PRODUCTS P ON OD.PRODUCT_REF = P.PRODUCT_REF
        WHERE 
            P.CATEGORY_CODE = (SELECT CATEGORY_CODE FROM CATEGORIES WHERE CATEGORY_NAME LIKE '%Dessert%')
    )
GROUP BY CUSTOMER_CODE
HAVING COUNT(ORDER_NUMBER) <= 1;

-- 7. Clients en France et montant total des commandes en avril 1998
SELECT 
    C.CUSTOMER_CODE, 
    C.COMPANY, 
    C.PHONE, 
    SUM(OD.UNIT_PRICE * OD.QUANTITY) AS Total_Amount, 
    C.COUNTRY
FROM 
    CUSTOMERS C
LEFT JOIN 
    ORDERS O ON C.CUSTOMER_CODE = O.CUSTOMER_CODE
LEFT JOIN 
    ORDER_DETAILS OD ON O.ORDER_NUMBER = OD.ORDER_NUMBER
WHERE 
    C.COUNTRY = 'France' 
    AND MONTH(O.ORDER_DATE) = 4 
    AND YEAR(O.ORDER_DATE) = 1998
GROUP BY 
    C.CUSTOMER_CODE;

-- 8. Clients ayant commandé tous les produits
SELECT 
    CUSTOMER_CODE, 
    COMPANY, 
    PHONE
FROM 
    CUSTOMERS
WHERE 
    CUSTOMER_CODE NOT IN (
        SELECT DISTINCT CUSTOMER_CODE 
        FROM ORDERS O
        JOIN ORDER_DETAILS OD ON O.ORDER_NUMBER = OD.ORDER_NUMBER
    )
GROUP BY CUSTOMER_CODE
HAVING COUNT(DISTINCT OD.PRODUCT_REF) = (SELECT COUNT(*) FROM PRODUCTS);

-- 9. Clients de France et nombre de commandes
SELECT 
    CUSTOMER_CODE, 
    COUNT(O.ORDER_NUMBER) AS Number_of_Orders
FROM 
    CUSTOMERS C
LEFT JOIN 
    ORDERS O ON C.CUSTOMER_CODE = O.CUSTOMER_CODE
WHERE 
    C.COUNTRY = 'France'
GROUP BY 
    C.CUSTOMER_CODE;

-- 10. Nombre de commandes en 1996 et 1997
SELECT 
    SUM(CASE WHEN YEAR(ORDER_DATE) = 1996 THEN 1 ELSE 0 END) AS Orders_in_1996,
    SUM(CASE WHEN YEAR(ORDER_DATE) = 1997 THEN 1 ELSE 0 END) AS Orders_in_1997,
    SUM(CASE WHEN YEAR(ORDER_DATE) = 1996 THEN 1 ELSE 0 END) - 
    SUM(CASE WHEN YEAR(ORDER_DATE) = 1997 THEN 1 ELSE 0 END) AS Difference
FROM 
    ORDERS;